version: "3.3"

services:
  pytest:
    sysctls:
      - "net.ipv6.conf.all.disable_ipv6=0"
    image: chia-test
    network_mode: bridge
    environment:
      - PYVER
      - CHIAPROFILE
    volumes:
      - CHIAHOME:/app
    command: ["sh", "-c", "if [ -z \"${CHIAPROFILE}\" ] ; then conda run -n python${PYVER} --no-capture-output python3 -m cProfile -o profile -m pytest --durations 0 TEST_DIR ; else conda run -n python${PYVER} --no-capture-output pytest --durations 0 TEST_DIR ; fi"]
